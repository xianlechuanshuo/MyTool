<script type="text/javascript">

// function svtlocation(d) { 
// // svtid是从者下拉列表
// // <select id="svtid" onchange="svtlocation(this.value);"><option value="9940600">No.0 丑御前</option>...</select>	
// 	d = ""; 
// 	for (var a in master.mstSvt) 
// 	if (master.mstSvt[a].id == svtid.value) { 
// 		d = 0 != master.mstSvt[a].collectionNo ? d + ("?no=" + master.mstSvt[a].collectionNo) : d + ("?id=" + master.mstSvt[a].id); 
// 		break 
// 	} 
// 	"file:" == location.protocol ? changeURL(location.protocol + "//" + location.pathname + d) : changeURL(location.protocol + "//" + location.hostname + location.pathname + d); 
// 	svtidChange();
// }


// function svtidChange() { 
// 	// svtlv是等级下拉列表
// 	// <select id="svtlv" onchange="svtlvChange()"><option value="100">Lv.100</option>...</select>
// 	// 	
// 	var d; 
// 	for (d = svtlv.options.length - 1; 0 <= d; d--) svtlv.remove(d); 
// 	for (d in master.mstSvt) if (master.mstSvt[d].id == svtid.value) { 
// 		for (d = 100; 0 < d; d--) svtlv.options.add(new Option("Lv." + d, d)); break 
// 	} 
// 	svtlvChange(); 
// 	svtDataTable(svtid.value); 
// 	drawChart() 
// }

// function svtlvChange() {
// 	var d, a = 0, h = 0, m = 0, q = 0; 
// 	for (d in master.mstSvtLimit) master.mstSvtLimit[d].svtId == svtid.value && (a = master.mstSvtLimit[d].hpBase, h = master.mstSvtLimit[d].hpMax, m = master.mstSvtLimit[d].atkBase, q = master.mstSvtLimit[d].atkMax); for (var k in master.mstSvt) if (master.mstSvt[k].id == svtid.value) {
// 		for (var e in master.mstSvtExp) if (atk.value = m, hp.value = a, four(), master.mstSvt[k].expType == master.mstSvtExp[e].type && master.mstSvtExp[e].lv == svtlv.value) {
// 			atk.value = Math.floor(m + (q - m) * master.mstSvtExp[e].curve /
// 				1E3); hp.value = Math.floor(a + (h - a) * master.mstSvtExp[e].curve / 1E3); four(); break
// 		} break
// 	}
// }
// function svtDataTable(d) {
// 		// <tr>
// 		// 	<th>等級</th>
// 		// 	<th>ATK</th>
// 		// 	<th>HP</th>
// 		// 	<th>上升幅度</th>
// 		// </tr>
// 		// <tr align="center">
// 		// 	<td bgcolor="#ECF2F3">Lv.1</td>
// 		// 	<td bgcolor="#ECF2F3">1699</td>
// 		// 	<td bgcolor="#ECF2F3">2288</td>
// 		// 	<td bgcolor="#ECF2F3">0%</td>
// 		// </tr>	
// 		//escape("等级")=>"%u7B49%u7EA7"=>"\u7b49\u7EA7"(?)
// 		//h=721,n=406,m=305,302000
// 		//
// 		//master.mstSvt[h].id == d  ===>master.mstSvt[721].id == 302000
// 		//
// 		//master.mstSvtLimit[m].svtId == d  ====>master.mstSvtLimit[305].svtId == 302000
// 		//
// 		//master.mstSvt[h].expType == master.mstSvtExp[n].expType  ===>master.mstSvt[721].expType == master.mstSvtExp[406].type
// 		//
// 		//
// 		//
// 		//ATK：master.mstSvtLimit[305].atkBase+((master.mstSvtLimit[305].atkMax - master.mstSvtLimit[305].atkBase) * master.mstSvtExp[406].curve / 1E3)：1801.256
// 		//master.mstSvtLimit[305].atkBase：1699
// 		//master.mstSvtLimit[305].atkMax - master.mstSvtLimit[305].atkBase：9296
// 		//master.mstSvtExp[406].curve：11
// 		//master.mstSvtExp[406].curve / 1E3：0.0011
// 		//上面的等价于这个：master.mstSvtExp[406].curve / 1000：0.0011
//     ... d = "<tr><th>\u7b49\u7d1a</th><th>ATK</th><th>HP</th><th>\u4e0a\u5347\u5e45\u5ea6</th></tr>",
//     a = 0; 100 > a; a++) for (n = 0; n < master.mstSvtExp.length; n++) if (master.mstSvt[h].expType == master.mstSvtExp[n].type && master.mstSvtExp[n].lv == a + 1) {
//         r = ""; 1 == master.mstSvtExp[n].lv % 2 && (r = ' bgcolor="#ECF2F3"'); d += '<tr align="center"><td' + r + ">Lv." + master.mstSvtExp[n].lv + "</td><td" + r + ">" + Math.floor(master.mstSvtLimit[m].atkBase + (master.mstSvtLimit[m].atkMax - master.mstSvtLimit[m].atkBase) * master.mstSvtExp[n].curve / 1E3) + "</td><td" + r + ">" + Math.floor(master.mstSvtLimit[m].hpBase + (master.mstSvtLimit[m].hpMax - master.mstSvtLimit[m].hpBase) *
//         master.mstSvtExp[n].curve / 1E3) + "</td><td" + r + ">" + (master.mstSvtExp[n].curve - master.mstSvtExp[n - 1].curve) / 10 + "%</td></tr>"; break
//     } 
//     $("#svtLvData").html(d); 
// }





    (function () { 
		let result=[];
        for (let i = 0; i < svtid.options.length; i++) {
        	let opt=svtid.options[i];
        	let d=opt.value;//302000
        	//获取no：119
        	//No.119 阿爾托莉亞・潘德拉剛
        	let servantName=opt.innerHTML;
        	let begin=servantName.indexOf(".")+1;
        	let end=servantName.indexOf(" ");
        	let no=servantName.substring(begin,end);
        	if(no==0)continue;

        	let h,m,n;
        	//1.得到h
        	for(h=0;h<master.mstSvt.length;h++){
        		if(master.mstSvt[h].id==d) {
        			//1.得到h
					break;
        		}
        	}

        	//2.得到m					
			for(m=master.mstSvtLimit.length-1;m>=0;m--){
				if (master.mstSvtLimit[m].svtId == d) {
					// console.log(`master.mstSvtLimit[${m}].svtId == ${d}`)
					break;
				}
			}

	        for (let a = 0; a <100; a++) {
				//3.得到n 
				for (n = 0; n < master.mstSvtExp.length; n++) {
					if (master.mstSvt[h].expType == master.mstSvtExp[n].type && master.mstSvtExp[n].lv == a + 1) {
						//4.计算每级的atk和hp
			        	let lvModel={
			        		n:no,
			        		// d:d,//302000
			        		l:a+1,
			        		a:Math.floor(master.mstSvtLimit[m].atkBase+(master.mstSvtLimit[m].atkMax - master.mstSvtLimit[m].atkBase) * master.mstSvtExp[n].curve / 1E3),
			        		h: Math.floor(master.mstSvtLimit[m].hpBase + (master.mstSvtLimit[m].hpMax - master.mstSvtLimit[m].hpBase) * master.mstSvtExp[n].curve / 1E3)
			        	}
			        	result.push(lvModel);
	            	 	break;
					}
				}

	        }	
	    }      
	    result=JSON.stringify(result).replace(/\"/gi,"");
        console.log("var lvs="+result);
    })();


    //800100(学妹)：h=485,m=839,n=203~302 
    //201300(阿拉十)：h=515,m=169,n=1~100
    //302000(白枪呆)：h=721,m=309,n=405~504
    (function (d) { 
			let result=[];
        	let opt=document.querySelector(`#svtid>option[value="${d}"]`);
        	//获取no：119
        	//No.119 阿爾托莉亞・潘德拉剛
        	let servantName=opt.innerHTML;
        	let begin=servantName.indexOf(".")+1;
        	let end=servantName.indexOf(" ");
        	let no=servantName.substring(begin,end);
        	// console.log(`servantName=${servantName}`);
        	// console.log(`no=${no}`);

        	let h,m,n;
        	//1.得到h
        	for(h=0;h<master.mstSvt.length;h++){
        		if(master.mstSvt[h].id==d) {
        			 // console.log(`master.mstSvt[${h}].id==${d},${master.mstSvt[h].id==d}`);
        			
        			
        			//1.得到h
					break;
        		}
        	}
        	// console.log(`这里的h=${h}`);


        	//2.得到m
        	//正序：得到m=835(学妹：800100)，错误
			// for(m=0;m<master.mstSvtLimit.length;m++){
			// 	if (master.mstSvtLimit[m].svtId == d) {
			// 		// console.log(`master.mstSvtLimit[${m}].svtId == ${d}`)
			// 		break;
			// 	}
			// }
			// 倒序：得到m=839(学妹：800100)，正确
			// 原因对比下：master.mstSvtLimit[839]和master.mstSvtLimit[835]的json字符串即可知道，STM atk和hp两套不一样数据，一个加强后，一个加强前，其他虽然都有两套，但是都是一样的。
			/*  master.mstSvtLimit[839]：(满破四星学妹)
				{"svtId":800100,"limitCount":4,"rarity":4,"lvMax":80,"hpBase":2060,"hpMax":11516,"atkBase":1455,"atkMax":7815,"criticalWeight":99,"power":31,"defense":11,"agility":41,"magic":21,"luck":31,"treasureDevice":98,"policy":3,"personality":1,"deity":99}		
			 */
			/*  master.mstSvtLimit[835]：(零破三星学妹)
			 	{"svtId":800100,"limitCount":0,"rarity":3,"lvMax":30,"hpBase":1854,"hpMax":10302,"atkBase":1261,"atkMax":6791,"criticalWeight":99,"power":31,"defense":11,"agility":41,"magic":21,"luck":31,"treasureDevice":98,"policy":3,"personality":1,"deity":99}
			*/			
			/*  master.mstSvtLimit[309]：(满破白枪呆)
				{"svtId":302000,"limitCount":4,"rarity":5,"lvMax":90,"hpBase":2288,"hpMax":15606,"atkBase":1699,"atkMax":10995,"criticalWeight":89,"power":21,"defense":11,"agility":11,"magic":11,"luck":31,"treasureDevice":13,"policy":3,"personality":1,"deity":99}"
			*/	
			/*  master.mstSvtLimit[305]：(零破白枪呆)
				{"svtId":302000,"limitCount":0,"rarity":5,"lvMax":50,"hpBase":2288,"hpMax":15606,"atkBase":1699,"atkMax":10995,"criticalWeight":89,"power":21,"defense":11,"agility":11,"magic":11,"luck":31,"treasureDevice":13,"policy":3,"personality":1,"deity":99}"
			*/						
			for(m=master.mstSvtLimit.length-1;m>=0;m--){
				if (master.mstSvtLimit[m].svtId == d) {
					// console.log(`master.mstSvtLimit[${m}].svtId == ${d}`)
					break;
				}
			}
			// console.log(`h=${h},m=${m}`);

			
	        for (let a = 0; a <100; a++) {
				//3.得到n 
				for (n = 0; n < master.mstSvtExp.length; n++) {
					if (master.mstSvt[h].expType == master.mstSvtExp[n].type && master.mstSvtExp[n].lv == a + 1) {
						//4.计算每级的atk和hp
			        	let lvModel={
			        		no:no,
			        		d:d,//302000
			        		lv:a+1,
			        		atk:Math.floor(master.mstSvtLimit[m].atkBase+(master.mstSvtLimit[m].atkMax - master.mstSvtLimit[m].atkBase) * master.mstSvtExp[n].curve / 1E3),
			        		hp: Math.floor(master.mstSvtLimit[m].hpBase + (master.mstSvtLimit[m].hpMax - master.mstSvtLimit[m].hpBase) * master.mstSvtExp[n].curve / 1E3)
			        	}
			        	result.push(lvModel);
			        	// console.log(`h=${h},m=${m},n=${n}`);
	            	 	break;
					}
				}

	        }	        	
	    result=JSON.stringify(result).replace(/\"/gi,"");
        console.log("var lvs="+result);
    })(201300);
}


</script>    


